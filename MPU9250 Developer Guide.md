# 1.简介
## 1.1.目的和应用范围
此文档主要介绍了MPU9250传感器的功能特性和使用方法。并详细介绍了传感器内置**数字运动处理器(DMP)**和Invensense官方的**MPL算法库**的使用方法及相关注意事项。在阅读本文档之前，请了解产品规格手册、寄存器映射手册。参考Motion Driver6.12的相关文档和源代码可以加深对DMP和MPL的理解。
## 1.2.概述
MPU9250是一个多芯片模组，包含了两个裸片并集成在一个QFN封装中。一片是3轴陀螺仪和3轴加速度计MPU6500，另一片是3轴磁力计AK8963。因此，这是一个9轴的运动检测设备，包括3轴陀螺仪、3轴加速度计、3轴磁力计和一个数字运动处理器（DMP）。  
使用400kHz的I<sup>2</sup>C或者1MHz的SPI与传感器的寄存器通信。只进行读操作时，最高可以提供20MHz的SPI时钟频率。辅助I<sup>2</sup>C总线可以支持第三方外部传感器与MPU相连接，磁力计AK8963也是以此接口连接。
## 1.3.特性
### 1.3.1.传感器特性
+ 3轴角速度数字量输出，量程可配置为±250, ±500, ±1000, 和 ±2000°/sec，最高输出速率是8000Hz
+ 3轴加速度数字量输出，量程可配置为±2g, ±4g, ±8g 和 ±16g，最高输出速率是4000Hz
+ 3轴磁力计数字量输出，量程是±4800μT
+ 数字低通滤波器
+ 带自检功能
+ 可编程中断
### 1.3.2.其它特性
+ 辅助I<sup>2</sup>C总线用于读取外部传感器数据包括内部的AK8963磁力计
+ 512字节FIFO缓冲器可用于突发读取
+ 数字输出温度传感器
+ 用于陀螺仪、加速计和温度传感器的数字滤波器
### 1.3.3运动处理
# 2.应用
## 2.1.主要引脚
|引脚号|  名称|  描述  |
|:--:|:------:| ------------------------------------------- |
|7 |AUX_CL  |I<sup>2</sup>C主机串行时钟线，用于连接外部传感器   |
|9 |AD0/SDO |I<sup>2</sup>C从机地址最低位；SPI串行数据输出(SDO)|
|11|FSYNC   |帧同步输入，不用时接地                            |
|12|INT     |中断输出(推挽或开漏)                             |
|21|AUX_DA  |I<sup>2</sup>C主机串行数据，用于连接外部传感器     |
|22|nCS     |片选(SPI模式可用)                                |
|23|SCL/SCLK|I<sup>2</sup>C串行时钟(SCL)；SPI串行时钟(SCLK)   |
|24|SDA/SDI |I<sup>2</sup>C串行数据(SDA)；SPI串行数据输入(SDI) |
- MPU会根据处理器与的连接使用对应的接口，在使用SPI时，应设置I2C_IF_DIS位以防止被切换到I<sup>2</sup>C模式。
- 可通过MPU将FSYNC引脚输入的中断信号传递给处理器。FSYNC引脚的信号也可以通过配置EXT_SYNC_SET[2:0]寄存器使其锁存到数据寄存器中，FSYNC的功能比较少用到。
## 2.2.串行接口
### 2.2.1.I<sup>2</sup>C接口
MPU9250始终以I<sup>2</sup>从机模式与处理器通信。

|---|---|
|时钟|最高400kHz|
|7位地址|0b110100_(最低位地址由AD0引脚电平确定)|

ADDRESS

|MSB||||||||LSB|
|:---:|
|0|1|1|0|1|0|0|AD0|R/W|
单次写序列

|---| 
|Master|S|AD+W||RA||DATA||P|
|Slave |||ACK||ACK||ACK||
单次读序列

|---| 
|Master|S|AD+W||RA||S|AD+R|||NACK|P|
|Slave |||ACK||ACK|||ACK|DATA|||

突发写序列

|---|
|Master|S|AD+W||RA||DATA||DATA||P|
|Slave |||ACK||ACK||ACK||ACK||

突发读序列

|---|
|Master|S|AD+W||RA||S|AD+R|||ACK||NACK|P|
|Slave |||ACK||ACK|||ACK|DATA||DATA|||

I<sup>2</sup>C符号

|信号|描述|
|:----:|
|S|开始信号|
|AD|从机I2C地址|
|W|写位(0)|
|R|读位(1)|
|ACK|应答|
|NACK|非应答|
|RA|寄存器地址|
|DATA|发送或接收的数据|
|P|停止信号|
### 2.2.2.SPI接口
MPU9250始终以SPI从机模式运行。**支持单次或突发读写。**

 
|---|:---|
|时钟|最高1MHz(读取数据时最高可达20MHz)|
|时钟极性|CPOL = 1(空闲时钟线为高)|
|时钟相位|CPHA = 1(数据在第二个时钟边沿被采集)|

**SPI访问寄存器地址格式**

|MSB|||||||LSB|
|---|---|---|---|---|---|---|:---:|
|R/W|A6|A5|A4|A3|A2|A1|A0|
**SPI数据格式**

|MSB|||||||LSB|
|:---:|---|---|---|---|---|:---:|
|D7|D6|D5|D4|D3|D2|D1|D0|

### 2.2.3.辅助I<sup>2</sup>C接口
MPU9250拥有辅助I<sup>2</sup>C总线用于与其连接的外部传感器通信。此总线的时序要求与MPU作为I<sup>2</sup>C从机的时序要求一致。其可工作在两种模式：  

 - I<sup>2</sup>C主机模式：MPU9250作为主机与外部传感器通过此接口连接。在此模式下，MPU9250不需经过处理器直接从外部传感器获取数据。最多可配置5个从机，通过**I2C_SLVx_ADDR,I2C_SLVx_REG,I2C_SLVx_CTRL,I2C_SLVx_DO**寄存器操作总线。从机0-3支持突发读取，其数据存在EXT_SENS_DATA_00-23寄存器。从机4只支持单次读取，数据存于I2C_SLV4_DI寄存器。通过配置I2C_Master的相关寄存器，可以配置此总线的参数以及对外部传感器的采样率。更多细节请参考**寄存器映射**手册。
 - 直通模式：在此模式下，允许处理器直接与外部传感器通信，只在处理器通过I<sup>2</sup>C总线与MPU连接时可用，不能用于SPI总线模式。辅助总线将不会被MPU9250控制，而是由处理器通过主I<sup>2</sup>C总线控制。此模式对于配置外部传感器而言是很有效的。处理器同样可以此种模式访问AK8963磁力计，其从机地址为0x0C。

MPU9250通过一个Bypass Multiplexer可以将辅助I<sup>2</sup>C直连到处理器的I<sup>2</sup>C总线，从而实现直通模式。在此模式下，一旦第三方传感器配置完成，应禁止Bypass Multiplexer从而将总线控制权交给MPU9250，以便从外部传感器读取数据。

## 2.3.FIFO
MPU9250内部包含一个512字节的FIFO，可通过串行接口访问。可配置将陀螺仪数据、角速度数据、温度数据、外部传感器数据和FSYNC输入数据存入到FIFO。但在使用DMP功能时，FIFO只能存入3轴角速度、3轴加速度和四元数数据。FIFO计数器保持监测FIFO中可用的字节数，该值存于寄存器。FIFO寄存器支持突发读取，当有新数据可用时可产生中断。
## 2.4.中断
MPU9250带有一个可编程中断引脚，可通过**INT_PNI_CFG,INT_ENABLE**以及相关寄存器配置。可触发中断项：  

 1. 当时钟源被锁定到新的参考时钟(当转换开关时可用)
 2. 有新的可读数据(FIFO或数据寄存器)
 3. 加速计事件中断
 4. 没有从辅助传感器接收到应答

|中断名|类型|
|---|
|||

中断状态可以从中断状态寄存器**INT_STATUS**查看

# 3.功能
## 3.1.数字运动处理器(DMP)
## 3.2.自检
